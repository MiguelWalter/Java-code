import java.io.*;
import java.util.*;

public class JavaApplication1 {

    static class Player {
        String playerId;
        String gameId;
        int currency;

        Player(String playerId, String gameId, int currency) {
            this.playerId = playerId;
            this.gameId = gameId;
            this.currency = currency;
        }
    }

    public static void main(String[] args) {
        // Define the filename (adjust the path if necessary)
        String filename = "C:\\Users\\Miguel\\Documents\\NetBeansProjects\\JavaApplication1\\src\\GameAnalyticsDataset.csv";  // Adjust the file name if needed
        
        // Print the current working directory
        System.out.println("Current directory: " + System.getProperty("user.dir"));

        // Check if the file exists before trying to read it
        File file = new File(filename);
        if (!file.exists()) {
            System.out.println("Error: The file " + filename + " does not exist.");
            return;  // Exit if the file doesn't exist
        }

        // Reading player data from the file
        List<Player> players = readPlayerData(filename);

        // Aggregate the players by their ID (sum up their currencies)
        Map<String, Integer> playerCurrencyMap = aggregatePlayerCurrencies(players);

        // Ensure that at least two players exist before trying to compare
        if (playerCurrencyMap.size() >= 2) {
            // Create a list of player IDs for selection
            List<String> playerIds = new ArrayList<>(playerCurrencyMap.keySet());

            // Prompt user to select two Player IDs for comparison
            Scanner scanner = new Scanner(System.in);
            System.out.println("Available Player IDs: " + playerIds);
            
            System.out.print("Enter Player ID for comparison 1: ");
            String playerId1 = scanner.nextLine().trim();

            System.out.print("Enter Player ID for comparison 2: ");
            String playerId2 = scanner.nextLine().trim();

            // Validate that both player IDs exist
            if (!playerCurrencyMap.containsKey(playerId1) || !playerCurrencyMap.containsKey(playerId2)) {
                System.out.println("Error: One or both player IDs are invalid or not found.");
                return;
            }

            // Get the aggregated currency values for both players
            int player1Currency = playerCurrencyMap.get(playerId1);
            int player2Currency = playerCurrencyMap.get(playerId2);

            // Comparing currency
            compareCurrency(playerId1, player1Currency, playerId2, player2Currency);
        } else {
            System.out.println("Not enough players to compare.");
        }
    }

    // Method to read player data from file
    public static List<Player> readPlayerData(String filename) {
        List<Player> players = new ArrayList<>();
        
        try (BufferedReader br = new BufferedReader(new FileReader(filename))) {
            String line;
            // Skip the header line
            br.readLine();  // Assuming the first line is headers

            while ((line = br.readLine()) != null) {
                // Trim whitespace and skip empty lines
                line = line.trim();
                if (line.isEmpty()) {
                    continue;  // Skip empty lines
                }

                String[] parts = line.split(",");
                if (parts.length >= 8) {  // We expect at least 8 fields (including Player ID and In-Game Currency)
                    String playerId = parts[0].trim();
                    String gameId = parts[1].trim();
                    String currencyStr = parts[7].trim();  // In-Game Currency is the 8th column

                    try {
                        int currency = Integer.parseInt(currencyStr);
                        players.add(new Player(playerId, gameId, currency));
                    } catch (NumberFormatException e) {
                        System.out.println("Error parsing currency for player: " + playerId + " (currency value: " + currencyStr + ")");
                    }
                } else {
                    System.out.println("Skipping invalid line: " + line);
                }
            }
        } catch (IOException e) {
            System.out.println("Error reading file: " + e.getMessage());
        }

        return players;
    }

    // Method to aggregate player currencies (sum up currencies for the same playerId)
    public static Map<String, Integer> aggregatePlayerCurrencies(List<Player> players) {
        Map<String, Integer> playerCurrencyMap = new HashMap<>();
        
        for (Player player : players) {
            playerCurrencyMap.put(player.playerId,
                    playerCurrencyMap.getOrDefault(player.playerId, 0) + player.currency);
        }
        
        return playerCurrencyMap;
    }

    // Method to compare the currency of two players
    public static void compareCurrency(String playerId1, int player1Currency, String playerId2, int player2Currency) {
        System.out.println("Comparing Player " + playerId1 + " and Player " + playerId2);

        if (player1Currency > player2Currency) {
            System.out.println(playerId1 + " has more currency (" + player1Currency + ") than " + playerId2 + " (" + player2Currency + ")");
        } else if (player1Currency < player2Currency) {
            System.out.println(playerId2 + " has more currency (" + player2Currency + ") than " + playerId1 + " (" + player1Currency + ")");
        } else {
            System.out.println(playerId1 + " and " + playerId2 + " have the same amount of currency: " + player1Currency);
        }
    }
}
